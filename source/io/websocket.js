Jcap.websocket=Jcap.module({model:"events",option:{host:top.location.hostname||"localhost",port:3e3,path:"",url:""},"protected":{initEvents:function(){var t=this,e=t.socket;return Jcap_extend(e,{onopen:function(n){t.emit("open",n),1===e.readyState&&0!==t.sendQueue.length&&(t.sendQueue.each(function(t,n){e.send(n)}),t.sendQueue.clear())},onmessage:function(e){t.emit("message",e)},onerror:function(e){t.emit("error",e)},onclose:function(e){t.emit("close",e),t.socket=NULL}}),t}},"public":{connect:function(t){var e=this,n=e.opts,o=NULL;if(isObject(t))e.opts=n=e.init_opts(t),e.url="ws://"+n.host+":"+n.port+"/"+n.path;else{if(!isString(t))return e;var s=e.url=Jcap.url(t);e.init_opts({host:s.domain,port:s.port,path:s.path})}return isFunction(WebSocket)?o=new WebSocket(e.url):isFunction(MozWebSocket)&&(o=new MozWebSocket(e.url)),e.socket=o,e.initEvents().emit("connect")},send:function(t){var e=this,n=e.socket;if(n!==NULL){var o=n.readyState;0===o?e.sendQueue.push(t):1===o&&n.send(t)}return e},close:function(t,e){var n=this,o=n.socket;return o!==NULL&&(o.close(t,e),n.socket=NULL),n},readyState:function(){var t=this,e=t.socket;return e===NULL?3:e.readyState}},main:function(t){var e=this;e.sendQueue=[],isObject(t)?isString(t.url)?e.connect(t.url):(t.on&&e.on(t.on),e.connect(t)):isString(t)&&e.connect(t)}});